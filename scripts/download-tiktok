#!/usr/bin/env bash
# Script para descargar videos de TikTok de forma segura
# Uso: download-tiktok "URL"

set -euo pipefail

# Verificar que se proporcione una URL
if [ $# -eq 0 ]; then
    echo "‚ùå Error: Debes proporcionar una URL de TikTok"
    echo "üí° Uso: download-tiktok 'https://www.tiktok.com/@usuario/video/ID'"
    exit 1
fi

URL="$1"

# Verificar que la URL sea de TikTok
if [[ ! "$URL" =~ tiktok\.com ]]; then
    echo "‚ùå Error: La URL no parece ser de TikTok"
    exit 1
fi

echo "üéµ Descargando video de TikTok..."
echo "üìã URL: $URL"

# Crear directorio espec√≠fico para TikTok si no existe
mkdir -p ~/Descargas/Videos/TikTok

# Descargar con configuraci√≥n espec√≠fica para TikTok
yt-dlp \
    --output "~/Descargas/Videos/TikTok/%(uploader)s_%(upload_date)s_%(title)s.%(ext)s" \
    --format "best[height<=1080]/best" \
    --write-info-json \
    --write-thumbnail \
    --embed-metadata \
    --restrict-filenames \
    --no-overwrites \
    "$URL"

echo "‚úÖ ¬°Descarga completada! Los archivos est√°n en ~/Descargas/Videos/TikTok/"

# Mostrar archivos descargados
echo "üìÅ Archivos descargados:"
ls -la ~/Descargas/Videos/TikTok/ | tail -5

